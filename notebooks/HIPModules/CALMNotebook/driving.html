<!-- Imports. -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/p5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/addons/p5.dom.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/addons/p5.sound.min.js"></script>

<!-- Makes screen take full width and height. -->
<style>
    * {
      margin: 0;
      padding: 0;
    }
</style>
<script>
    
    var consumptionLevels;

    var yLines = [10, 120, 230, 340];
    function setup() {
        createCanvas(400, 400);
        
        consumptionLevels = createSlider(1, 3, 1);
        consumptionLevels.position(20, 20);
    }

    var x = 200;
    var y = 200;
    function drawCar() {
        // Tires.
        fill(0, 0, 0);
        ellipse(x+35, y+30, 20, 40);
        ellipse(x+105, y+30, 20, 40);
        ellipse(x+35, y+145, 20, 40);
        ellipse(x+105, y+145, 20, 40);

        // Body.
        fill(5, 5, 161);
        rect(x+30, y-10, 80, 70, 20);
        rect(x+30, y+110, 80, 70, 20);
        fill(0, 0, 200);
        rect(x+30, y+30, 80, 100);
    };
    
    var xOncoming = 60;
    var yOncoming = -200;
    function drawOncoming() {
        // Tires.
        fill(0, 0, 0);
        ellipse(xOncoming+35, yOncoming+30, 20, 40);
        ellipse(xOncoming+105, yOncoming+30, 20, 40);
        ellipse(xOncoming+35, yOncoming+145, 20, 40);
        ellipse(xOncoming+105, yOncoming+145, 20, 40);

        // Body.
        fill(139,0,0);
        rect(xOncoming+30, yOncoming-10, 80, 70, 20);
        rect(xOncoming+30, yOncoming+110, 80, 70, 20);
        fill(210, 0, 0);
        rect(xOncoming+30, yOncoming+40, 80, 100);
    };

    var speed = 3;
    var yLines = [10, 120, 230, 340];
    function draw() {
        background(200, 200, 200);
        noStroke();
        
        // Grass.
        fill(50, 150, 100);
        rect(0, 0, 70, 400);
        rect(330, 0, 70, 400);
        
        // Rails.
        fill(105, 105, 105);
        rect(60, 0, 10, 400);
        rect(330, 0, 10, 400);
        
        // Yellow lines.
        for (var i = 0; i < 5; i++) {
            fill(232, 232, 0);
            rect(187, yLines[i], 10, 50);

            yLines[i]+=speed;
            if (yLines[i] > 400) {
                yLines[i] = -40;
            }
        }
        
        yOncoming+=10;
        if (yOncoming > 2000) {
            yOncoming = -200;
        }
        
        drawOncoming();
        
        fill(0);
        textSize(12);
        if (consumptionLevels.value() == 1) {
            text("Sober", consumptionLevels.x + 10 + consumptionLevels.width, 30);
            if (keyIsDown(65)) {
                x-=5;
                if (x < 0) {
                   x = 0;
                }
             }
             if (keyIsDown(68)) {
                x+=5;
                if (x > 300) {
                   x = 300;
                }
             }
             if (keyIsDown(87)) {
                speed+=5; 
                if (speed > 15) {
                    speed = 15;
                }
             }
             if (keyIsDown(83)) {
                speed-=5;
                if (speed < 3) {
                    speed = 3;
                }
             }
        }
        if (consumptionLevels.value() == 2) {
            text("Intoxicated", consumptionLevels.x + 10 + consumptionLevels.width, 30);
            if (keyIsDown(68)) {
                x-=5;
                if (x < 0) {
                   x = 0;
                }
             }
             if (keyIsDown(65)) {
                x+=5;
                if (x > 300) {
                   x = 300;
                }
             }
             if (keyIsDown(83)) {
                speed+=5; 
                if (speed > 15) {
                    speed = 15;
                }
             }
             if (keyIsDown(87)) {
                speed-=5;
                if (speed < 3) {
                    speed = 3;
                }
             }
        }
        if (consumptionLevels.value() == 3) {
            text("Wasted", consumptionLevels.x + 10 + consumptionLevels.width, 30);
            if (keyIsDown(68)) {
                x-=5;
                if (x < 0) {
                   x = 0;
                }
                if (random(0, 4) < 1) {
                    x+=10;
                }
             }
             if (keyIsDown(65)) {
                x+=5;
                if (x > 300) {
                   x = 300;
                }
                if (random(0, 4) < 1) {
                    x-=10;
                }
             }
             if (keyIsDown(83)) {
                speed+=5; 
                if (speed > 15) {
                    speed = 15;
                }
                if (random(0, 4) < 1) {
                    speed-=10;
                }
             }
             if (keyIsDown(87)) {
                speed-=5;
                if (speed < 3) {
                    speed = 3;
                }
                if (random(0, 4) < 1) {
                    speed+=10;
                }
             }
        }
         
        drawCar();
        
        textSize(20);
        if (x > 230) {
            fill(255, 0, 0);
            text("Game Over.", 150, 200);
            Program.restart();
        }
        if (x < 30) {
            fill(255, 0, 0);
            text("Game Over.", 150, 200);
            Program.restart();
        }
        
        if (x >= xOncoming && x <= xOncoming+80 && y >= yOncoming && y <= yOncoming+180) {
            fill(255, 0, 0);
            text("Game Over.", 150, 200);
            Program.restart();
        }
        if (x+80 >= xOncoming && x+80 <= xOncoming+80 && y >= yOncoming && y <= yOncoming+180) {
            fill(255, 0, 0);
            text("Game Over.", 150, 200);
            Program.restart();
        }
        if (x >= xOncoming && x <= xOncoming+80 && y+180 >= yOncoming && y+180 <= yOncoming+180) {
            fill(255, 0, 0);
            text("Game Over.", 150, 200);
            Program.restart();
        }
         
    }

</script>
